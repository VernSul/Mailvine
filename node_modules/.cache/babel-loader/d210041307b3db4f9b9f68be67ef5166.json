{"ast":null,"code":"import _toConsumableArray from \"/home/victor/Documents/dadTools/emailFinder/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _objectSpread from \"/home/victor/Documents/dadTools/emailFinder/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _regeneratorRuntime from \"/home/victor/Documents/dadTools/emailFinder/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/victor/Documents/dadTools/emailFinder/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/home/victor/Documents/dadTools/emailFinder/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/victor/Documents/dadTools/emailFinder/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/victor/Documents/dadTools/emailFinder/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/victor/Documents/dadTools/emailFinder/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/victor/Documents/dadTools/emailFinder/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/victor/Documents/dadTools/emailFinder/src/components/Message.js\";\nimport React from 'react';\nimport { connect } from 'react-redux';\nimport axios from 'axios';\nimport Switch from \"react-switch\";\nimport * as actions from '../Actions/actions';\n\nvar mapStateToProps = function mapStateToProps(store) {\n  return {\n    recipient: store.recipient,\n    emails: store.emails,\n    address: store.selAddress\n  };\n};\n\nvar mapDispatchToProps = function mapDispatchToProps(dispatch) {\n  return {\n    newRecip: function newRecip(data) {\n      return dispatch(actions.newRecip(data));\n    },\n    setTemplate: dta\n  };\n};\n\nvar Message =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Message, _React$Component);\n\n  function Message(props) {\n    var _this;\n\n    _classCallCheck(this, Message);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Message).call(this, props));\n    _this.getTemplates =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var response, templates, key;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return axios('http://localhost:4000/gettemplate');\n\n            case 2:\n              response = _context.sent;\n              response = response.data.hits.hits;\n              templates = new Map();\n\n              for (key in response) {\n                templates.set(response[key]._id, response[key]._source);\n              }\n\n              _this.setState({\n                templates: templates\n              });\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    _this.changeSubject = function (e) {\n      var text = e.target.value;\n\n      var nwSub = _objectSpread({}, _this.state.subject);\n\n      if (_this.state.mode) {\n        nwSub.template = nwSub.rendered = text;\n        if (_this.props.recipient) nwSub.message = _this.loadTemplate(_this.state.subject.template);\n\n        _this.setState({\n          subject: nwSub\n        });\n      } else {\n        nwSub.rendered = nwSub.message = text;\n\n        _this.setState({\n          subject: nwSub\n        });\n      }\n    };\n\n    _this.changeMessage = function (e) {\n      var text = e.target.value;\n\n      if (_this.state.mode) {\n        _this.setState({\n          template: text,\n          rendered: text\n        }, function () {\n          return console.log(_this.state);\n        });\n\n        if (_this.props.recipient) _this.setState({\n          text: _this.loadTemplate(_this.state.template)\n        });\n      } else {\n        _this.setState({\n          rendered: text,\n          text: text\n        });\n      }\n    };\n\n    _this.upFirst = function (word) {\n      return word.charAt(0).toUpperCase() + word.slice(1);\n    };\n\n    _this.changeMode = function () {\n      if (!_this.props.recipient || !_this.state.templateId) return _this.setState({\n        mode: true\n      });\n\n      _this.setState({\n        mode: !_this.state.mode\n      },\n      /*#__PURE__*/\n      _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2() {\n        var nwSubj;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                nwSubj = _objectSpread({}, _this.state.subject);\n\n                if (!_this.state.mode) {\n                  _this.templateAction('update');\n\n                  _this.getTemplates();\n\n                  nwSubj.rendered = nwSubj.message;\n\n                  _this.setState({\n                    rendered: _this.state.text,\n                    subject: nwSubj\n                  });\n                } else {\n                  nwSubj.rendered = nwSubj.template;\n\n                  _this.setState({\n                    rendered: _this.state.template,\n                    subject: nwSubj\n                  });\n                }\n\n              case 2:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      })));\n    };\n\n    _this.placeAttribute = function (e) {\n      if (e.target.value === 'Add attribute') return;\n      var textemp = _this.state.focus === 'message' ? _this.state.template.slice(0) : _this.state.subject.template.slice(0);\n      var text = _this.state.focus === 'message' ? document.getElementById('emailEditor') : document.getElementById('subject');\n      var nwTemp = textemp.split(\"\");\n\n      if (text.selectionStart === text.selectionEnd) {\n        var _nwTemp;\n\n        (_nwTemp = nwTemp).splice.apply(_nwTemp, [text.selectionStart, 0].concat(_toConsumableArray(\"{\" + e.target.value + \"}\".split(''))));\n      } else {\n        var _nwTemp2;\n\n        (_nwTemp2 = nwTemp).splice.apply(_nwTemp2, [text.selectionStart, text.selectionEnd - text.selectionStart].concat(_toConsumableArray(\"{\" + e.target.value + \"}\".split(''))));\n      }\n\n      nwTemp = nwTemp.join(\"\");\n      if (_this.state.focus === 'message') _this.setState({\n        template: nwTemp,\n        rendered: nwTemp\n      });else {\n        var nwSubj = _objectSpread({}, _this.state.subject);\n\n        nwSubj.template = nwSubj.rendered = nwTemp;\n\n        _this.setState({\n          subject: nwSubj\n        });\n      }\n      document.getElementsByTagName('select')[0].value = 'Add attribute';\n    };\n\n    _this.sendMessage = function () {\n      var body = \"\";\n\n      var headers = _objectSpread({}, _this.state.headers, {\n        subject: _this.state.subject.message\n      });\n\n      for (var h in headers) {\n        body += h += \": \" + headers[h] + \"\\r\\n\";\n      }\n\n      body += \"\\r\\n\" + _this.state.text; //replace(/\\+/g, '-').replace(/\\//g, '_')\n\n      var sendRequest = window.gapi.client.gmail.users.messages.send({\n        'userId': 'me',\n        'resource': {\n          'raw': window.btoa(body)\n        }\n      });\n      return sendRequest.execute(function (a) {\n        console.log(a);\n      }, function (error) {\n        console.log(error);\n      });\n    };\n\n    _this.templateAction =\n    /*#__PURE__*/\n    function () {\n      var _ref3 = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4(action) {\n        var del, upd;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                console.log(action);\n                _context4.t0 = action;\n                _context4.next = _context4.t0 === \"save\" ? 4 : _context4.t0 === \"delete\" ? 6 : _context4.t0 === \"update\" ? 11 : _context4.t0 === \"new\" ? 16 : 18;\n                break;\n\n              case 4:\n                axios.post('http://localhost:4000/recordtemplate', {\n                  name: document.getElementById(\"templateName\").value,\n                  subject: _this.state.headers.subject,\n                  text: _this.state.template\n                }).then(\n                /*#__PURE__*/\n                function () {\n                  var _ref4 = _asyncToGenerator(\n                  /*#__PURE__*/\n                  _regeneratorRuntime.mark(function _callee3(resp) {\n                    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n                      while (1) {\n                        switch (_context3.prev = _context3.next) {\n                          case 0:\n                            console.log(resp);\n\n                            _this.setState({\n                              newTemplate: false,\n                              templateId: document.getElementById(\"templateName\").value\n                            });\n\n                            _this.getTemplates();\n\n                          case 3:\n                          case \"end\":\n                            return _context3.stop();\n                        }\n                      }\n                    }, _callee3);\n                  }));\n\n                  return function (_x2) {\n                    return _ref4.apply(this, arguments);\n                  };\n                }());\n                return _context4.abrupt(\"break\", 18);\n\n              case 6:\n                _context4.next = 8;\n                return axios.post(\"http://localhost:4000/deletetemplate\", {\n                  name: _this.state.templateId\n                });\n\n              case 8:\n                del = _context4.sent;\n                console.log(del);\n                return _context4.abrupt(\"break\", 18);\n\n              case 11:\n                _context4.next = 13;\n                return axios.post('http://localhost:4000/updatetemplate', {\n                  name: _this.state.templateId,\n                  subject: _this.state.subject.template,\n                  text: _this.state.template\n                });\n\n              case 13:\n                upd = _context4.sent;\n                console.log(upd);\n                return _context4.abrupt(\"break\", 18);\n\n              case 16:\n                if (_this.state.templateId) _this.templateAction(\"update\");\n\n                _this.setState({\n                  template: \"\",\n                  text: \"\",\n                  templateId: false,\n                  newTemplate: true\n                });\n\n              case 18:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }));\n\n      return function (_x) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    _this.selectTemplate = function (id) {\n      if (id === 'Add template') return;\n\n      _this.setState({\n        templateId: id\n      }, function () {\n        var template;\n\n        if (_this.state.mode) {\n          template = _this.state.templates.get(_this.state.templateId);\n\n          var nwSubj = _objectSpread({}, _this.state.subject);\n\n          nwSubj.rendered = nwSubj.template = template.subject;\n\n          _this.setState({\n            template: template.text,\n            rendered: template.text,\n            subject: nwSubj\n          }, function () {\n            if (_this.props.recipient) {\n              var _nwSubj = _objectSpread({}, _this.state.subject);\n\n              _nwSubj.message = _this.loadTemplate(template.subject);\n\n              _this.setState({\n                text: _this.loadTemplate(_this.state.template),\n                subject: _nwSubj\n              });\n            }\n          });\n        } else {\n          template = _this.state.templates.get(_this.state.templateId);\n\n          var _nwSubj2 = _objectSpread({}, _this.state.subject);\n\n          _nwSubj2.rendered = _nwSubj2.message = _this.loadTemplate(template.subject);\n          _nwSubj2.rendered = template.subject;\n\n          _this.setState({\n            template: template.text,\n            text: _this.loadTemplate(_this.state.template),\n            rendered: _this.loadTemplate(_this.state.template)\n          });\n        }\n      });\n    };\n\n    _this.loadTemplate = function (temp) {\n      var text = temp.split('');\n\n      var first = _this.upFirst(_this.props.recipient.first);\n\n      var last = _this.upFirst(_this.props.recipient.last);\n\n      var company = _this.upFirst(_this.props.recipient.domain.split('.')[0]);\n\n      for (var i = 0; i < text.length - 1; i++) {\n        if (text[i] === '{') {\n          var j = i;\n\n          while (text[j] !== \"}\") {\n            j = j + 1;\n          }\n\n          var word = text.slice(i + 1, j).join('');\n          var repwr = void 0;\n\n          switch (word) {\n            case \"FullName\":\n              repwr = first + \" \" + last;\n              break;\n\n            case \"FirstName\":\n              repwr = first;\n              break;\n\n            case \"LastName\":\n              repwr = last;\n              break;\n\n            case \"Company\":\n              repwr = company;\n              break;\n          }\n\n          text.splice(i, j - i + 1, repwr);\n        }\n      }\n\n      return text.join(''); // this.setState( {text, rendered: text} );\n    };\n\n    _this.state = {\n      headers: {\n        from: \"vicfaucon@gmail.com\",\n        to: _this.props.recipient.address\n      },\n      text: '',\n      templates: new Map(),\n      rendered: '',\n      template: '',\n      mode: false,\n      newTemplate: false,\n      subject: {\n        temp: '',\n        message: '',\n        rendered: ''\n      },\n      focus: null\n    };\n    return _this;\n  }\n\n  _createClass(Message, [{\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee5() {\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                console.log(\"component is mounting: \", this.props.recipient);\n                this.getTemplates();\n                this.changeMode();\n\n              case 3:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function componentDidMount() {\n        return _componentDidMount.apply(this, arguments);\n      }\n\n      return componentDidMount;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var templates = [];\n      this.state.templates.forEach(function (x, i) {\n        if (x) templates.push(React.createElement(\"option\", {\n          key: i,\n          value: x.name,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 274\n          },\n          __self: this\n        }, x.name));\n      });\n      var tempSet = React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 277\n        },\n        __self: this\n      }, React.createElement(\"select\", {\n        onClick: this.placeAttribute,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 278\n        },\n        __self: this\n      }, React.createElement(\"option\", {\n        value: \"Add attribute\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 279\n        },\n        __self: this\n      }, \"Add attribute\"), React.createElement(\"option\", {\n        value: \"FullName\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 280\n        },\n        __self: this\n      }, \"Full Name\"), React.createElement(\"option\", {\n        value: \"FirstName\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 281\n        },\n        __self: this\n      }, \"First Name\"), React.createElement(\"option\", {\n        value: \"LastName\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 282\n        },\n        __self: this\n      }, \"Last Name\"), React.createElement(\"option\", {\n        value: \"Company\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 283\n        },\n        __self: this\n      }, \"Company\")));\n      return React.createElement(\"div\", {\n        className: \"Message\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 290\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"EmailForm\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 292\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        id: \"to\",\n        placeholder: \"To\",\n        value: this.props.address,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 293\n        },\n        __self: this\n      }), React.createElement(\"input\", {\n        id: \"subject\",\n        placeholder: \"Subject\",\n        value: this.state.subject.rendered,\n        onChange: this.changeSubject,\n        onFocus: function onFocus() {\n          _this2.setState({\n            focus: 'subject'\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 294\n        },\n        __self: this\n      }), React.createElement(\"div\", {\n        id: \"setting\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 296\n        },\n        __self: this\n      }, this.state.newTemplate ? React.createElement(\"input\", {\n        id: \"templateName\",\n        placeholder: \"Name the new template\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 297\n        },\n        __self: this\n      }) : null, this.state.mode ? tempSet : null, React.createElement(Switch, {\n        className: \"Switch\",\n        onChange: this.changeMode,\n        checked: this.state.mode,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 300\n        },\n        __self: this\n      }), this.state.newTemplate ? null : React.createElement(\"select\", {\n        id: \"templatesName\",\n        onClick: function onClick(e) {\n          return _this2.selectTemplate(e.target.value);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 302\n        },\n        __self: this\n      }, React.createElement(\"option\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 303\n        },\n        __self: this\n      }, \"Add template\"), templates)), React.createElement(\"textarea\", {\n        id: \"emailEditor\",\n        placeholder: \"Type your email\",\n        value: this.state.rendered,\n        onChange: this.changeMessage,\n        onClick: this.getCursPos,\n        onFocus: function onFocus() {\n          _this2.setState({\n            focus: 'message'\n          });\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 308\n        },\n        __self: this\n      }), this.state.mode ? React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 310\n        },\n        __self: this\n      }, React.createElement(\"button\", {\n        id: \"delete\",\n        onClick: function onClick(e) {\n          return _this2.templateAction(e.target.id);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 311\n        },\n        __self: this\n      }, \"Delete\"), React.createElement(\"button\", {\n        id: \"update\",\n        onClick: function onClick(e) {\n          return _this2.templateAction(e.target.id);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 312\n        },\n        __self: this\n      }, \"Update\")) : React.createElement(\"button\", {\n        onClick: this.sendMessage,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 314\n        },\n        __self: this\n      }, \"Send\"), this.state.newTemplate ? React.createElement(\"button\", {\n        id: \"save\",\n        onClick: function onClick(e) {\n          return _this2.templateAction(e.target.id);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 315\n        },\n        __self: this\n      }, \"Save\") : React.createElement(\"button\", {\n        id: \"new\",\n        onClick: function onClick(e) {\n          return _this2.templateAction(e.target.id);\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 316\n        },\n        __self: this\n      }, \"New\")));\n    }\n  }]);\n\n  return Message;\n}(React.Component);\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Message);","map":{"version":3,"sources":["/home/victor/Documents/dadTools/emailFinder/src/components/Message.js"],"names":["React","connect","axios","Switch","actions","mapStateToProps","store","recipient","emails","address","selAddress","mapDispatchToProps","dispatch","newRecip","data","setTemplate","dta","Message","props","getTemplates","response","hits","templates","Map","key","set","_id","_source","setState","changeSubject","e","text","target","value","nwSub","state","subject","mode","template","rendered","message","loadTemplate","changeMessage","console","log","upFirst","word","charAt","toUpperCase","slice","changeMode","templateId","nwSubj","templateAction","placeAttribute","textemp","focus","document","getElementById","nwTemp","split","selectionStart","selectionEnd","splice","join","getElementsByTagName","sendMessage","body","headers","h","sendRequest","window","gapi","client","gmail","users","messages","send","btoa","execute","a","error","action","post","name","then","resp","newTemplate","del","upd","selectTemplate","id","get","temp","first","last","company","domain","i","length","j","repwr","from","to","forEach","x","push","tempSet","getCursPos","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { connect } from 'react-redux';\nimport axios from 'axios';\nimport Switch from \"react-switch\";\n\nimport * as actions from '../Actions/actions'\n\nconst mapStateToProps = store => ({\n        recipient: store.recipient,\n        emails: store.emails,\n        address: store.selAddress\n});\n\nconst mapDispatchToProps = dispatch => ({\n    newRecip: data => dispatch(actions.newRecip(data)),\n    setTemplate: dta\n})\n\n\n\nclass Message extends React.Component{\n    constructor(props){\n        super(props);\n        this.state = {\n            headers: {\n                from:\"vicfaucon@gmail.com\",\n                to: this.props.recipient.address,\n            },\n            text: '',\n            templates: new Map(),\n            rendered: '',\n            template: '',\n            mode: false,\n            newTemplate: false,\n            subject: {temp:'', message: '', rendered: ''},\n            focus: null\n        }\n    }\n\n\n    async componentDidMount(){\n        console.log(\"component is mounting: \", this.props.recipient)\n        this.getTemplates();\n        this.changeMode();\n    }\n\n    getTemplates = async () => {\n        let response = await axios('http://localhost:4000/gettemplate');\n        response = response.data.hits.hits;\n\n        let templates = new Map();\n        for(let key in response){\n            templates.set(response[key]._id, response[key]._source);\n        }\n        this.setState( { templates } );\n\n    }\n\n    changeSubject = (e) => {\n        let text = e.target.value;\n        let nwSub = {...this.state.subject};\n        if(this.state.mode) {\n            nwSub.template = nwSub.rendered = text;\n            if(this.props.recipient) nwSub.message = this.loadTemplate(this.state.subject.template);\n            this.setState( { subject: nwSub });\n        } else {\n            nwSub.rendered = nwSub.message = text;\n            this.setState( {subject: nwSub} );\n        }\n    }\n\n    changeMessage = (e) => {\n        let text = e.target.value;\n        if(this.state.mode) {\n            this.setState( { template: text, rendered: text }, () => console.log(this.state) );\n            if(this.props.recipient) this.setState( { text: this.loadTemplate(this.state.template) } );\n        } else {\n            this.setState( {rendered: text, text} )\n        }\n    }\n\n    upFirst = (word) => {\n        return word.charAt(0).toUpperCase() + word.slice(1);\n\n    }\n\n    changeMode = () => {\n        if(!this.props.recipient || !this.state.templateId) return this.setState( {mode: true});\n\n        this.setState( {mode: !this.state.mode }, async () => {\n            let nwSubj = {...this.state.subject}\n            if(!this.state.mode){\n                this.templateAction('update');\n                this.getTemplates();\n                nwSubj.rendered = nwSubj.message\n                this.setState( { rendered: this.state.text, subject: nwSubj } );\n            } else {\n                nwSubj.rendered = nwSubj.template;\n                this.setState( {rendered: this.state.template,  subject: nwSubj} )\n            }\n        });\n    }\n\n  \n\n    placeAttribute = (e) => {\n\n        if(e.target.value === 'Add attribute') return;\n    \n        let textemp = this.state.focus === 'message' ? this.state.template.slice(0) : this.state.subject.template.slice(0);\n\n        let text = this.state.focus === 'message' ? document.getElementById('emailEditor') : document.getElementById('subject');\n\n        let nwTemp = textemp.split(\"\")\n\n        if(text.selectionStart === text.selectionEnd){\n            nwTemp.splice(text.selectionStart, 0, ...\"{\"+e.target.value+\"}\".split(''));\n        } else {\n            nwTemp.splice(text.selectionStart, text.selectionEnd - text.selectionStart, ...\"{\"+e.target.value+\"}\".split(''))\n        }\n\n        nwTemp = nwTemp.join(\"\");\n\n        \n        if(this.state.focus === 'message') this.setState( { template: nwTemp, rendered: nwTemp} );\n        else {\n            let nwSubj = {...this.state.subject};\n            nwSubj.template = nwSubj.rendered = nwTemp;\n            this.setState( { subject: nwSubj } );\n        }\n  \n        document.getElementsByTagName('select')[0].value = 'Add attribute';\n\n    }\n\n    sendMessage = () => {\n        let body = \"\";\n        let headers = {...this.state.headers, subject: this.state.subject.message}\n        for(let h in headers){\n            body += h += \": \" + headers[h] + \"\\r\\n\"\n        }\n        body += \"\\r\\n\" + this.state.text;\n\n        //replace(/\\+/g, '-').replace(/\\//g, '_')\n        const sendRequest = window.gapi.client.gmail.users.messages.send({\n            'userId': 'me',\n            'resource': {\n                'raw': window.btoa(body)\n            }\n        })\n\n        return sendRequest.execute((a)=> {console.log(a)}, (error)=>{console.log(error)})\n\n    }\n\n    templateAction = async (action) => {\n        console.log(action);\n        switch(action){\n            case \"save\":\n                axios.post('http://localhost:4000/recordtemplate', {\n                    name: document.getElementById(\"templateName\").value,\n                    subject: this.state.headers.subject,\n                    text: this.state.template\n                }).then(async (resp) => {\n                    console.log(resp);\n                    this.setState({newTemplate: false, templateId:document.getElementById(\"templateName\").value });\n                    this.getTemplates();\n                });\n                break;\n            \n            case \"delete\":\n                let del = await axios.post(\"http://localhost:4000/deletetemplate\", {name: this.state.templateId});\n                console.log(del);\n                break;\n\n            case \"update\":\n                let upd = await axios.post('http://localhost:4000/updatetemplate', {name: this.state.templateId, subject:this.state.subject.template, text: this.state.template});\n                console.log(upd);\n                break;\n\n            case \"new\":\n                if(this.state.templateId) this.templateAction(\"update\");\n                this.setState({template:\"\", text:\"\", templateId: false, newTemplate: true})\n                \n\n        }\n\n    }\n \n    selectTemplate = (id) => {\n        if(id === 'Add template') return;\n\n\n        this.setState( {templateId: id}, () => {\n            let template;\n\n            if(this.state.mode) {\n                template = this.state.templates.get(this.state.templateId);\n                let nwSubj = {...this.state.subject};\n                nwSubj.rendered = nwSubj.template = template.subject;\n                \n                this.setState( {template:template.text, rendered:template.text, subject:nwSubj}, () => {\n                    if(this.props.recipient) {\n                        let nwSubj = {...this.state.subject};\n                        nwSubj.message = this.loadTemplate(template.subject);\n                        this.setState( {text: this.loadTemplate(this.state.template), subject: nwSubj } );\n                    }\n                });\n\n     \n            }\n            else {\n                template = this.state.templates.get(this.state.templateId);\n                let nwSubj = {...this.state.subject};\n                nwSubj.rendered = nwSubj.message = this.loadTemplate(template.subject);\n                nwSubj.rendered = template.subject;\n                this.setState( {template:template.text, text: this.loadTemplate(this.state.template), rendered:this.loadTemplate(this.state.template)} )\n            }\n        });\n        \n        \n    }\n    \n    loadTemplate = (temp) => {\n        let text = temp.split('');\n\n\n        let first = this.upFirst(this.props.recipient.first);\n        let last = this.upFirst(this.props.recipient.last);\n        let company = this.upFirst(this.props.recipient.domain.split('.')[0]);\n\n\n        for(let i = 0; i < text.length-1; i++){\n            if(text[i] === '{'){\n                let j = i;\n                while(text[j] !== \"}\"){\n                    j = j + 1;\n                }\n                let word = text.slice(i+1, j).join('');\n                let repwr;\n                switch(word){\n                    case \"FullName\":\n                        repwr = first + \" \" + last;\n                        break;\n                    case \"FirstName\":\n                        repwr = first;\n                        break;\n                    case \"LastName\":\n                        repwr = last;\n                        break;\n                    case \"Company\":\n                        repwr = company;\n                        break;\n                }\n                text.splice(i, j-i+1, repwr)\n                \n            }\n            \n        }\n\n        return text.join('');\n\n        // this.setState( {text, rendered: text} );\n\n    }\n\n\n\n    render(){\n\n        let templates = [];\n\n        this.state.templates.forEach((x, i) => {\n            if(x) templates.push(<option key={i} value={x.name}>{x.name}</option>)\n        })\n\n        let tempSet = <span>\n                        <select onClick={this.placeAttribute}>\n                            <option value=\"Add attribute\">Add attribute</option>\n                            <option value=\"FullName\">Full Name</option>\n                            <option value=\"FirstName\">First Name</option>\n                            <option value=\"LastName\">Last Name</option>\n                            <option value=\"Company\">Company</option>\n                        </select>\n                       \n                    </span>\n        \n\n        return(\n            <div className=\"Message\">\n                \n                <div className=\"EmailForm\">\n                    <input id=\"to\" placeholder=\"To\" value={this.props.address}/>\n                    <input  id=\"subject\" placeholder=\"Subject\" value={this.state.subject.rendered} onChange={this.changeSubject} onFocus={() => {this.setState({focus:'subject'})}}/>\n                    \n                    <div id=\"setting\">\n                        {this.state.newTemplate ?  <input id=\"templateName\" placeholder=\"Name the new template\"/> : null}\n                        {this.state.mode ? tempSet : null}\n                    \n                        <Switch className=\"Switch\" onChange={this.changeMode} checked={this.state.mode} />\n                        {this.state.newTemplate ? null :\n                            <select id=\"templatesName\" onClick={(e) => this.selectTemplate(e.target.value)}>\n                                <option>Add template</option>\n                                {templates}\n                            </select>}\n                    </div>\n\n                    <textarea  id=\"emailEditor\" placeholder=\"Type your email\" value={this.state.rendered} onChange={this.changeMessage} onClick={this.getCursPos} onFocus={() => {this.setState({focus:'message'})}}/>\n                    {this.state.mode ? \n                    <span>\n                        <button id=\"delete\" onClick={(e)=>this.templateAction(e.target.id)}>Delete</button>\n                        <button id=\"update\" onClick={(e)=>this.templateAction(e.target.id)}>Update</button>\n                    </span>\n                    : <button onClick={this.sendMessage}>Send</button>}\n                    {this.state.newTemplate ? <button id=\"save\" onClick={(e)=>this.templateAction(e.target.id)}>Save</button> :\n                    <button id=\"new\" onClick={(e)=>this.templateAction(e.target.id)}>New</button>}\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default connect(\n    mapStateToProps,\n    mapDispatchToProps\n)(Message);"]},"metadata":{},"sourceType":"module"}