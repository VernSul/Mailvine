{"ast":null,"code":"import _regeneratorRuntime from \"/home/victor/Documents/dadTools/emailFinder/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/victor/Documents/dadTools/emailFinder/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _toConsumableArray from \"/home/victor/Documents/dadTools/emailFinder/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _objectSpread from \"/home/victor/Documents/dadTools/emailFinder/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _classCallCheck from \"/home/victor/Documents/dadTools/emailFinder/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/victor/Documents/dadTools/emailFinder/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/victor/Documents/dadTools/emailFinder/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/victor/Documents/dadTools/emailFinder/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/victor/Documents/dadTools/emailFinder/node_modules/@babel/runtime/helpers/esm/inherits\";\nvar _jsxFileName = \"/home/victor/Documents/dadTools/emailFinder/src/Message.js\";\nimport React from 'react';\nimport axios from 'axios';\nimport lodash from 'lodash';\n\nvar Message =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Message, _React$Component);\n\n  function Message(props) {\n    var _this;\n\n    _classCallCheck(this, Message);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Message).call(this, props));\n\n    _this.changeSubject = function (e) {\n      var s = _objectSpread({}, _this.state);\n\n      s.subject = e.target.value;\n\n      _this.setState(s);\n    };\n\n    _this.changeMessage = function (e) {\n      var text = e.target.value;\n\n      _this.setState({\n        text: text\n      });\n    };\n\n    _this.upFirst = function (word) {\n      return word.charAt(0).toUpperCase() + word.slice(1);\n    };\n\n    _this.placeAttribute = function (e) {\n      if (e.target.value === 'Add attribute') return;\n\n      var textemp = _this.state.template || _this.state.text.slice(0);\n\n      var text = document.getElementById('emailEditor');\n\n      var first = _this.upFirst(_this.props.name.first);\n\n      var last = _this.upFirst(_this.props.name.last);\n\n      var company = _this.upFirst(_this.props.selAdd.split('@')[1].split('.')[0]);\n\n      var nwEl;\n\n      var nwText = _this.state.text.split(\"\");\n\n      var nwTemp = textemp.split(\"\");\n\n      switch (e.target.value) {\n        case \"FullName\":\n          nwEl = first + \" \" + last;\n          break;\n\n        case \"FirstName\":\n          nwEl = first;\n          break;\n\n        case \"LastName\":\n          nwEl = last;\n          break;\n\n        case \"Company\":\n          nwEl = company;\n          break;\n      }\n\n      var a = \"{\" + e.target.value + \"}\";\n      console.log(a.split(''));\n\n      if (text.selectionStart === text.selectionEnd) {\n        var _nwTemp;\n\n        nwText.splice(text.selectionStart, 0, nwEl);\n\n        (_nwTemp = nwTemp).splice.apply(_nwTemp, [text.selectionStart, 0].concat(_toConsumableArray(\"{\" + e.target.value + \"}\".split(''))));\n      } else {\n        var _nwTemp2;\n\n        nwText.splice(text.selectionStart, text.selectionEnd - text.selectionStart, nwEl);\n\n        (_nwTemp2 = nwTemp).splice.apply(_nwTemp2, [text.selectionStart, text.selectionEnd - text.selectionStart].concat(_toConsumableArray(\"{\" + e.target.value + \"}\".split(''))));\n      }\n\n      console.log(text.selectionEnd - text.selectionStart);\n      nwText = nwText.join(\"\");\n      nwTemp = nwTemp.join(\"\");\n\n      _this.setState({\n        text: nwText,\n        template: nwTemp\n      });\n    };\n\n    _this.sendMessage = function () {\n      var body = \"\";\n\n      for (var h in _this.state.headers) {\n        body += h += \": \" + _this.state.headers[h] + \"\\r\\n\";\n      }\n\n      body += \"\\r\\n\" + _this.state.text;\n      console.log(body);\n      var sendRequest = window.gapi.client.gmail.users.messages.send({\n        'userId': 'me',\n        'resource': {\n          'raw': window.btoa(body).replace(/\\+/g, '-').replace(/\\//g, '_')\n        }\n      });\n      return sendRequest.execute(function (a) {\n        console.log(a);\n      }, function (error) {\n        console.log(error);\n      });\n    };\n\n    _this.saveTemplate =\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var resp;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return axios.post('http://localhost:4000/recordtemplate', {\n                name: document.getElementById(\"templateName\").value,\n                subject: _this.state.headers.subject,\n                text: _this.state.template\n              });\n\n            case 2:\n              resp = _context.sent;\n              console.log(resp);\n\n            case 4:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    _this.selectTemplate = function (e) {\n      if (e.target.value === 'Add template') return;\n      var template = lodash.find(_this.state.templates, function (x) {\n        return x._source.name === e.target.value;\n      });\n      template = template._source.text;\n      var text = template.split(\" \");\n\n      var first = _this.upFirst(_this.props.name.first);\n\n      var last = _this.upFirst(_this.props.name.last);\n\n      var company = _this.upFirst(_this.props.selAdd.split('@')[1].split('.')[0]);\n\n      console.log(first, last, company);\n\n      for (var i = 0; i < text.length - 1; i++) {\n        if (text[i][0] === '{') {\n          var j = i;\n\n          while (text[j] !== '}') {\n            j += 1;\n          }\n\n          var word = text.slice(i);\n          word.pop();\n          word.shift();\n          word = word.join('');\n          console.log(word);\n\n          switch (word) {\n            case \"FullName\":\n              text[i] = first + \" \" + last;\n              break;\n\n            case \"FirstName\":\n              text[i] = first;\n              console.log(text[i], first);\n              break;\n\n            case \"LastName\":\n              text[i] = last;\n              break;\n\n            case \"Company\":\n              text[i] = company;\n              break;\n          }\n        }\n      }\n\n      console.log(text);\n      text = text.join(\" \");\n\n      _this.setState({\n        template: template,\n        text: text\n      });\n    };\n\n    _this.state = {\n      headers: {\n        from: \"vicfaucon@gmail.com\",\n        to: \"victorfaucon@hotmail.fr\",\n        subject: \"Full Stack Engineer position at \"\n      },\n      text: \"\",\n      templates: [],\n      template: false\n    };\n    return _this;\n  }\n\n  _createClass(Message, [{\n    key: \"componentWillMount\",\n    value: function () {\n      var _componentWillMount = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2() {\n        var _this2 = this;\n\n        var templates;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return axios('http://localhost:4000/gettemplate');\n\n              case 2:\n                templates = _context2.sent;\n                templates = templates.data.hits.hits;\n                this.setState({\n                  templates: templates\n                }, function () {\n                  console.log(_this2.state);\n                });\n\n              case 5:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function componentWillMount() {\n        return _componentWillMount.apply(this, arguments);\n      }\n\n      return componentWillMount;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      var templates = this.state.templates.map(function (x, i) {\n        return React.createElement(\"option\", {\n          key: i,\n          value: x._source.name,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 177\n          },\n          __self: this\n        }, x._source.name);\n      });\n      return React.createElement(\"div\", {\n        className: \"Message\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 181\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"EmailForm\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 182\n        },\n        __self: this\n      }, React.createElement(\"input\", {\n        placeholder: \"To\",\n        value: this.props.selAdd,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 183\n        },\n        __self: this\n      }), React.createElement(\"input\", {\n        placeholder: \"Subject\",\n        onChange: this.changeSubject,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184\n        },\n        __self: this\n      }), React.createElement(\"select\", {\n        onClick: this.placeAttribute,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 185\n        },\n        __self: this\n      }, React.createElement(\"option\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186\n        },\n        __self: this\n      }, \"Add attribute\"), React.createElement(\"option\", {\n        value: \"FullName\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 187\n        },\n        __self: this\n      }, \"Full Name\"), React.createElement(\"option\", {\n        value: \"FirstName\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 188\n        },\n        __self: this\n      }, \"First Name\"), React.createElement(\"option\", {\n        value: \"LastName\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 189\n        },\n        __self: this\n      }, \"Last Name\"), React.createElement(\"option\", {\n        value: \"Company\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 190\n        },\n        __self: this\n      }, \"Company\")), React.createElement(\"select\", {\n        onClick: this.selectTemplate,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192\n        },\n        __self: this\n      }, React.createElement(\"option\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 193\n        },\n        __self: this\n      }, \"Add template\"), templates), React.createElement(\"input\", {\n        id: \"templateName\",\n        placeholder: \"Name the new template\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 196\n        },\n        __self: this\n      }), React.createElement(\"textarea\", {\n        id: \"emailEditor\",\n        placeholder: \"Type your email\",\n        onChange: this.changeMessage,\n        onClick: this.getCursPos,\n        value: this.state.text,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 197\n        },\n        __self: this\n      }), React.createElement(\"button\", {\n        onClick: this.sendMessage,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198\n        },\n        __self: this\n      }, \"Send\"), React.createElement(\"button\", {\n        onClick: this.saveTemplate,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199\n        },\n        __self: this\n      }, \"Save Template\")));\n    }\n  }]);\n\n  return Message;\n}(React.Component);\n\nexport default Message;","map":{"version":3,"sources":["/home/victor/Documents/dadTools/emailFinder/src/Message.js"],"names":["React","axios","lodash","Message","props","changeSubject","e","s","state","subject","target","value","setState","changeMessage","text","upFirst","word","charAt","toUpperCase","slice","placeAttribute","textemp","template","document","getElementById","first","name","last","company","selAdd","split","nwEl","nwText","nwTemp","a","console","log","selectionStart","selectionEnd","splice","join","sendMessage","body","h","headers","sendRequest","window","gapi","client","gmail","users","messages","send","btoa","replace","execute","error","saveTemplate","post","resp","selectTemplate","find","templates","x","_source","i","length","j","pop","shift","from","to","data","hits","map","getCursPos","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport axios from 'axios';\nimport lodash from 'lodash';\n\nclass Message extends React.Component{\n    constructor(props){\n        super(props);\n        this.state = {\n            headers: {\n                from:\"vicfaucon@gmail.com\",\n                to:\"victorfaucon@hotmail.fr\",\n                subject: \"Full Stack Engineer position at \"\n            },\n            text: \"\",\n            templates: [],\n            template: false\n        }\n    }\n\n    async componentWillMount(){\n        let templates = await axios('http://localhost:4000/gettemplate');\n        templates = templates.data.hits.hits;\n        this.setState( { templates }, ()=>{console.log(this.state)} );\n    }\n\n\n    changeSubject = (e) => {\n        let s = { ...this.state };\n        s.subject = e.target.value;\n        this.setState(s);\n    }\n\n    changeMessage = (e) => {\n        let text = e.target.value\n        this.setState( { text } );\n    }\n\n    upFirst = (word) => {\n        return word.charAt(0).toUpperCase() + word.slice(1);\n\n    }\n\n  \n\n    placeAttribute = (e) => {\n\n        if(e.target.value === 'Add attribute') return;\n\n    \n        let textemp = this.state.template || this.state.text.slice(0);\n\n        let text = document.getElementById('emailEditor');\n        let first = this.upFirst(this.props.name.first);\n        let last = this.upFirst(this.props.name.last);\n        let company = this.upFirst(this.props.selAdd.split('@')[1].split('.')[0]);\n        \n        let nwEl;\n        let nwText = this.state.text.split(\"\");\n        let nwTemp = textemp.split(\"\")\n\n        switch(e.target.value){\n            case \"FullName\":\n                nwEl = first + \" \" + last;\n                break;\n            case \"FirstName\":\n                nwEl = first;\n                break;\n            case \"LastName\":\n                nwEl = last;\n                break;\n            case \"Company\":\n                nwEl = company;\n                break;\n        }\n        let a = \"{\"+e.target.value+\"}\";\n        console.log(a.split(''))\n        if(text.selectionStart === text.selectionEnd){\n            nwText.splice(text.selectionStart, 0, nwEl);\n            nwTemp.splice(text.selectionStart, 0, ...\"{\"+e.target.value+\"}\".split(''));\n        } else {\n            nwText.splice(text.selectionStart, text.selectionEnd - text.selectionStart, nwEl)\n            nwTemp.splice(text.selectionStart, text.selectionEnd - text.selectionStart, ...\"{\"+e.target.value+\"}\".split(''))\n        }\n\n        console.log(text.selectionEnd - text.selectionStart)\n\n        nwText = nwText.join(\"\")\n        nwTemp = nwTemp.join(\"\")\n        \n        this.setState( { text: nwText, template:nwTemp } );\n\n    }\n\n    sendMessage = () => {\n        let body = \"\"\n        for(let h in this.state.headers){\n            body += h += \": \" + this.state.headers[h] + \"\\r\\n\"\n        }\n        body += \"\\r\\n\" + this.state.text;\n\n        console.log(body)\n\n        const sendRequest = window.gapi.client.gmail.users.messages.send({\n            'userId': 'me',\n            'resource': {\n                'raw': window.btoa(body).replace(/\\+/g, '-').replace(/\\//g, '_')\n            }\n        })\n\n        return sendRequest.execute((a)=> {console.log(a)}, (error)=>{console.log(error)})\n\n    }\n\n    saveTemplate = async () => {\n        let resp = await axios.post('http://localhost:4000/recordtemplate', {\n            name: document.getElementById(\"templateName\").value,\n            subject: this.state.headers.subject,\n            text: this.state.template\n        })\n        console.log(resp);\n    }\n \n    selectTemplate = (e) => {\n        if(e.target.value === 'Add template') return;\n        let template = lodash.find(this.state.templates, function(x){return x._source.name === e.target.value});\n        template = template._source.text;\n        let text = template.split(\" \");\n\n        let first = this.upFirst(this.props.name.first);\n        let last = this.upFirst(this.props.name.last);\n        let company = this.upFirst(this.props.selAdd.split('@')[1].split('.')[0]);\n\n        console.log(first, last, company)\n\n        for(let i = 0; i < text.length-1; i++){\n            if(text[i][0] === '{'){\n                let j = i;\n                while(text[j] !== '}'){\n                    j += 1\n                }\n                let word = text.slice(i, )\n                word.pop();\n                word.shift();\n                word = word.join('');\n                console.log(word);\n                switch(word){\n                    case \"FullName\":\n                        text[i] = first + \" \" + last;\n                        break;\n                    case \"FirstName\":\n                        text[i] = first;\n                        console.log(text[i], first)\n                        break;\n                    case \"LastName\":\n                        text[i] = last;\n                        break;\n                    case \"Company\":\n                        text[i] = company;\n                        break;\n                }\n                \n            }\n        }\n\n        console.log(text);\n\n        text = text.join(\" \");\n\n        this.setState( {template, text})\n\n    }\n\n\n    render(){\n\n        let templates = this.state.templates.map((x, i) => {\n            return <option key={i} value={x._source.name}>{x._source.name}</option>\n        })\n\n        return(\n            <div className=\"Message\">\n                <div className=\"EmailForm\">\n                    <input placeholder=\"To\" value={this.props.selAdd}/>\n                    <input  placeholder=\"Subject\" onChange={this.changeSubject}/>\n                    <select onClick={this.placeAttribute}>\n                        <option>Add attribute</option>\n                        <option value=\"FullName\">Full Name</option>\n                        <option value=\"FirstName\">First Name</option>\n                        <option value=\"LastName\">Last Name</option>\n                        <option value=\"Company\">Company</option>\n                    </select>\n                    <select onClick={this.selectTemplate}>\n                        <option>Add template</option>\n                        {templates}\n                    </select>\n                    <input id=\"templateName\" placeholder=\"Name the new template\"></input>\n                    <textarea  id=\"emailEditor\" placeholder=\"Type your email\" onChange={this.changeMessage} onClick={this.getCursPos} value={this.state.text}/>\n                    <button onClick={this.sendMessage}>Send</button>\n                    <button onClick={this.saveTemplate}>Save Template</button>\n                </div>\n            </div>\n        )\n    }\n}\n\nexport default Message;"]},"metadata":{},"sourceType":"module"}